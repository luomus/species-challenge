<!-- Template for a page for submitting a new participation to a challenge. -->

{% extends "base.html" %}

{% block head %}
    <title>Osallistuminen haasteeseen {{ html['challenge']['title'] }}</title>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const listItems = document.querySelectorAll('#taxa li');
            listItems.forEach(li => {
                // Update class based on the initial state
                updateClass(li);

                // Add click event listener
                li.addEventListener('click', function() {
                    let dateInput = this.querySelector('input[type="date"]');
                    if (dateInput && dateInput.value === '') {
                        dateInput.value = new Date().toISOString().split('T')[0]; // Set to today's date
                        updateClass(this);
                    }
                });
            });
        });

        function updateClass(li) {
            let dateInput = li.querySelector('input[type="date"]');
            if (dateInput && dateInput.value !== '') {
                li.classList.add('date-filled');
            } else {
                li.classList.remove('date-filled');
            }
        }
    </script>
{% endblock %}

{% block body %}

    <h1>Osallistuminen haasteeseen {{ html['challenge']['title'] }}</h1>

    <p><a href="/haaste/{{ html["challenge_id"] }}">&laquo; Takaisin tämän haasteen etusivulle</a></p>

    <form action="/osallistuminen/{{ html['challenge_id'] }}/{{ html['participation_id'] }}" method="post">
    
        <p>
            <label for="name">Osallistujan nimi tai nimimerkki:</label>
            <input 
                type="text" 
                id="name" 
                name="name" 
                value="{{ html['data_fields'].get('name', '') }}"
            required>
        </p>

        <p>
            <label for="place">Paikka, esim. kunta:</label>
            <input 
                type="text" 
                id="place" 
                name="place" 
                value="{{ html['data_fields'].get('place', '') }}" 
            required>
        </p>
    
        <p>
            <button type="submit">Tallenna osallistuminen</button>
        </p>

        {% if html['data_fields']['taxa_count'] == 0 %}
            <p class="error">Et ole tallentanut vielä yhtään lajia.</p>
        {% else %}
            <h3>{{ html['data_fields']['taxa_count'] }} lajia</h3>
        {% endif %}

        {{ html['taxa']|safe }}
        
    </form>

{% endblock %}
